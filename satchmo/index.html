<!DOCTYPE html>
<html lang="en">
<!--[if lt IE 9]><script language="javascript" type="text/javascript" src="//html5shim.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Louis Armstrong Discography</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <link rel="shortcut icon" href="/images/favicon.png"> -->
    <meta name="description" content="I believe music can be a form of perfection - with nothing added or subtracted, flawless just the way it is. This is my take on the music and the people that make it. It's mostly about jazz and blues. Content and design by Žan Anderle">
    <link rel="canonical" href="http://musingsonmusic.com/satchmo/">

    

    <!-- Custom CSS -->
<!--    <link rel="stylesheet" href="/css/main.css"> -->
    <link href='http://fonts.googleapis.com/css?family=Belleza|Droid+Serif' rel='stylesheet' type='text/css'>
    <!-- SCSS, baby -->
    <link rel="stylesheet" href="/css/style.css">
    <link href="/css/select2.min.css" rel="stylesheet" />
    <!--[if lt IE 11]>
    <style type="text/css">
    .ie-warning { display: inline; }
    </style>
    <![endif]-->
    <script src="/js/modernizr.js"></script>
    <script src="/js/jquery-1.11.1.min.js"></script>
    <script src="/js/default.js"></script>
    <script src="/js/select2.min.js"></script>
    
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-53540157-1', 'auto');
      ga('send', 'pageview');

    </script>
    
</head>


    <body>
      <div id="wrap">
        <header class="site-header row clear">

    <nav class="social-media-nav col col-3 tablet-col-4 mobile-no-padding mobile-no-margin">
      <ul class="mobile-no-margin">
        <li class="inline-block">
          <a class="icon-twitter twitter mobile-no-margin" href="https://twitter.com/z_anderle" target="_blank"></a>
        </li>
        <li class="inline-block">
          <a class="icon-instagramm instagram mobile-no-margin" href="https://instagram.com/zanderle" target="_blank"></a>
        </li>
        <li class="inline-block">
          <a class="icon-mail-alt rss-feed mobile-no-margin" href="http://eepurl.com/bc2g2v" target="_blank" title="Subscribe!"></a>
        </li>
      </ul>
    </nav>
    <div class="logo-wrapper col col-6 tablet-col-4">
      <a class="main-logo container block" href="/"></a>
    </div>
    <div class="menu-wrapper col col-3 tablet-col-4">
      <a class="icon-menu right inline-block higher" id="menu" href="#"></a>
    </div>
    <nav class="site-nav right">
      <ul class="no-padding no-margin">
        <li class="inline-block">
          <a class="page-link" href="/">Blog</a>
        </li>
        
            
            
            
        
            
            
          <li class="inline-block">
            <a class="page-link" href="/about/">About</a>
          </li>
            
            
        
            
            
            
        
            
            
            
        
            
        
            
            
            
        
            
            
            
        
            
            
            
        
            
            
            
        
            
            
            
        
            
            
            
        
      </ul>
    </nav>



</header>

<div class="subheader text-center">
<h4 class="white heading inline-block">Music can be a form of perfection - with nothing added or subtracted, flawless just the way it is.</h4>
</div>


        <div class="row clear container">
          <div class="post single-post">

  <header class="post-header">
    <h1 class="text-center heading">Louis Armstrong Discography</h1>
    <!-- <div class="text-center misc">
        <i class="icon-calendar-empty inline-block"></i>
        <span class="inline-block"></span>
        
        <i class="icon-tag inline-block"></i>
        <span class="inline-block tags">Louis Armstrong Visualization</span>
    </div> -->
  </header>

  <article class="post-content">
  <h4 id="louis-armstrongs-lifework-visualized">Louis Armstrong’s lifework visualized</h4>

<div id="satchmo-container">
    <div class="plot-clip">
    </div>
    <div id="satchmo" style="width: 100%; overflow: auto;"></div>
    <div class="tooltip">
        <div class="gig"></div>
        <div class="date-and-location"></div>
        <div class="songs"></div>
        <div class="lineup"></div>
        <div class="comments"></div>
    </div>
    <div id="session-info"></div>
</div>
<div class="row clear song-selection hide-mobile">
    <form action="#">
        <label for="song-selection" class="col col-6 text-right">Show sessions with these songs: </label>
        <select id="song-selection" multiple="multiple" class="col col-4">
        </select>

<div class="row clear song-selection hide-mobile">
        <label for="lineup-selection" class="col col-6 text-right">and these band members: </label>
        <select id="lineup-selection" multiple="multiple" class="col col-4">
        </select>
    
</div>

<em class="none show-mobile">Unfortunately this interactive visualization is not supported on mobile devices. Come check it out on your tablet or computer.</em>

<em class="ie-warning">This visualization might not work properly under your browser. Consider upgrading or getting a different browser.</em>

<span class="font-small">A few technical details, for those interested. I used [d3](http://d3js.org/) library for the actual visualization. To get the data from the website I mentioned earlier, I used [import.io](http://import.io) (which was a joy to use, if I may add). And finally for parsing and cleaning up, Python was the way to go.</span>


<script type="text/javascript" src="/js/d3.min.js"></script>
<script type="text/javascript" src="/js/louis_armstrong.js"></script>
<script type="text/javascript" src="/js/handlebars-v3.0.1.js"></script>

<script id="event-template" type="text/x-handlebars-template">

  <div class="entry">
    <h3>{{title}}</h3>
    <p>
      {{body}}
    </p>
  </div>

</script>
<script id="session-template" type="text/x-handlebars-template">

<div class="row">
    <div class="col col-7 border-right">
        <h4 class="text-center">{{display_date}}<h4>
        <h3>{{name}}</h3>
        <h4>{{location}}</h4>
        <div class="first-section">
            <div class="inline-block no-split">
            {{lineup}}
            </div>
            <div class="no-split inline-block">
            {{comments}}
            </div>
        </div>
    </div>
    <div class="col col-5">
        <div class="side-section inline-block text-left">
        <ul class="list-unstyled">
          {{#each song_list}}
            <li>
              {{this}}  
            </li>
          {{/each}}
        </ul>
        </div>
    </div>
</div>

</script>

<script async="" type="text/javascript">

$(document).ready(function() {
  $("#song-selection").select2({
        data: satchmo_songs,
        placeholder: 'Start typing a song'
  });
  $("#lineup-selection").select2({
        data: members,
        placeholder: "Start typing a musician's name"
  });
});

// Helpers
function sizeOf(obj) {
    var count = 0;

    for(var prop in obj) {
        if(obj.hasOwnProperty(prop))
            ++count;
    }

    return count;
}

// Set the dimensions of the canvas / graph
var margin = {top: 40, right: 40, bottom: 40, left: 50};
var width = $('.post').width() - margin.left - margin.right;
var height = 600 - margin.top - margin.bottom;

$('.plot-clip').width(width)
                .height(height)
                .css({'left': margin.left, 'top': margin.top});


// Variables
var lowestOpacity = 0.01;
var lowerOpacity = 0.07;
var lowOpacity = 0.1;
var mediumOpacity = 0.3;
var highOpacity = 0.5;
var higherOpacity = 0.8;

// Date formater
var dateFormat = d3.time.format('%0d.%0m.%Y');

// Set scales
var minDate = dateFormat.parse('4.8.1901');
var maxDate = dateFormat.parse('6.7.1971');

var xScale = d3.time.scale()
            .range([0, width-10])
            .domain([minDate, maxDate]);

var cScale = d3.scale.ordinal()
            .range(["#8dd3c7","#d5d500","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"])
            .domain(satchmo_data, function (d) { d.location_group; });

var rScale = d3.scale.linear()
            .range([5, 18])
            .domain(d3.extent(satchmo_data, function (d) { return d.members.length; }));

var mScale = d3.scale.quantize()
                .range([0, 0.25, 0.75, 1])
                .domain([0, width]);

// Zoom

var zoom = d3.behavior.zoom()
    .x(xScale)
    .scaleExtent([1,100])
    .on('zoom', zoomed);

// Moving average

var yValue = function(d) {
    // Don't use this if you don't have to. Very expensive...
    interval = 360;
    low = d3.time.day.offset(d, -(interval/2));
    high = d3.time.day.offset(d, interval/2);
    // low = d3.time.day.offset(d, -interval);
    // high = d;
    function isInInterval (value) {
        return ((dateFormat.parse(value.display_date) < high) && (dateFormat.parse(value.display_date) > low));
    };
    recordings = satchmo_data.filter(isInInterval);
    return recordings.length;
};

var yScale = d3.scale.linear()
                    .range([height, height/2])
                    .domain([-2, d3.max(satchmo_data, function(d) { return d.density; })]);
                    // .domain([0, 37]);

var lineFunction = d3.svg.line()
                        .x(function (d) { return xScale(d); })
                        .y(function (d) { return yScale(yValue(d)); })
                        .interpolate('basis');

// Set xAxis
var xAxis = d3.svg.axis().scale(xScale).orient('bottom');
var yAxis = d3.svg.axis().scale(yScale).orient('left');


// Add svg canvas
var svg = d3.select("#satchmo").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .append("g")
    .attr('class', 'main')
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

var plotArea = svg.append('g')
    .attr('clip-path', 'url(#plotAreaClip)')
    .call(zoom);

plotArea.append('clipPath')
    .attr('id', 'plotAreaClip')
    .append('rect')
    .attr('width', width)
    .attr('height',height);


var dates = d3.time.day.range(new Date(1900,1,1), new Date(1971,7,8), 180);

// Add sessions
for (var i = satchmo_data.length - 1; i >= 0; i--) {
    satchmo_data[i].id = i;
};

var rect = plotArea.append("rect")
    .attr("width", width)
    .attr("height", height)
    .style("fill", "none")
    .style("pointer-events", "all");

var sessions = plotArea.selectAll('circle').data(satchmo_data).enter()
        .append('circle')
        .attr('class', 'session')
        .attr('r', 5)
        .attr('cx', function (d) { return xScale(dateFormat.parse(d.display_date)); })
        .attr('cy', 3*height/4)
        .attr('fill', 'gray')
        .attr('fill-opacity', 0.3);


// Events

var source   = $("#event-template").html();
var eventTemplate = Handlebars.compile(source);

var importantEvents = [{
    title: '04 Aug 1901',
    body: "Armstrong was born into a very poor family in New Orleans, Louisiana, the grandson of slaves. He spent his youth in poverty, in a rough neighborhood, known as “the Battlefield”, which was part of the Storyville legal prostitution district.",
    date: '04.08.1902',
    level: 0
},
{
    title: 'Hello, Dolly!',
    body: 'Louis Armstrong records a song that would soon throw The Beatles of the first place on the charts!',
    date: '03.12.1963',
    level: 0
}
];
// var importantEvents =[];


// Plot Events

var plotEvents = d3.select('#satchmo-container .plot-clip').selectAll('.important-event')
        .data(importantEvents)
        .enter()
        .append('div')
        .attr('class', 'important-event')
        .style('left', function (d) { return xScale(dateFormat.parse(d.date)) + 'px'; })
        .style('top', 80 + 'px')
        .html(function (d) { return eventTemplate(d); });

var eventLines = plotArea.selectAll('line')
    .data(importantEvents)
    .enter()
    .append('line')
    .style("stroke-dasharray", "5,2")
    .style('stroke', '#aaaaaa')
    .attr('x1', function (d) { return xScale(dateFormat.parse(d.date)); })
    .attr('x2', function (d) { return xScale(dateFormat.parse(d.date)); })
    .attr('y1', 220)
    .attr('y2', height - 25);


// Interactivity

$('#song-selection').on('change', selectSongs);
$('#lineup-selection').on('change', selectSongs);
var selected = {};
function setSelected (selection, song_ids, member_ids) {
    var selectedSongs = {};
    var selectedMembers = {};
    if (song_ids) {
        selection.each(function (d) { return (d.song_id_list.some(function (el) { return song_ids.indexOf((el).toString()) > -1; })) ? (selectedSongs[d.id] = true) : (delete selectedSongs[d.id]); });
    } 
    if (member_ids) {
        selection.each(function (d) { return (d.member_id_list.some(function (el) { return member_ids.indexOf((el).toString()) > -1; })) ? (selectedMembers[d.id] = true) : (delete selectedMembers[d.id]); });        
    }
    if (typeof song_ids !== 'undefined' | typeof member_ids !== 'undefined') {
        selected = $.merge(selectedSongs, selectedMembers);
        delete selected['length']; // No idea why this is needed, but it doesn't work otherwise
        if (sizeOf(selected) == 0) {
            selected = selectedMembers;
        } 
    } else {
        selected = {};
    }
}

function highlightSelected (selection, lowEnd, highEnd) {
    lowEnd = typeof lowEnd !== 'undefined' ? lowEnd : lowerOpacity;
    highEnd = typeof highEnd !== 'undefined' ? highEnd : lowerOpacity;
    selection.attr('fill-opacity', function (d) { return (d.id in selected) ? highEnd : lowEnd; });
}

function selectSongs () {
    var song_ids = $('#song-selection').val();
    var member_ids = $('#lineup-selection').val();
    sessions.call(setSelected, song_ids, member_ids)
    if (typeof song_ids !== 'undefined' | typeof member_ids !== 'undefined') {
        sessions.call(highlightSelected, lowestOpacity, higherOpacity);
    } else {
        sessions.attr('fill-opacity', mediumOpacity)
                .attr('stroke', 'none');
    }
};


var source   = $("#session-template").html();
var sessionTemplate = Handlebars.compile(source);
var sessionInfo = d3.select('#session-info');

bisectDate = d3.bisector(function(d) { return dateFormat.parse(d.display_date); }).left

rect.on("mouseover", mouseover)
      .on("mouseout", mouseout)
      .on("mousemove", mousemove);

// TODO Check if it's ok to use the same mouseover and mouseout functions
sessions.on("mouseover", mouseover)
        .on("mouseout", mouseout)
        .on('click', selectSession)
        .on('mousemove', mousemove);

function selectSession () {
    da = d3.select(this);
    session = da.data()[0];
    sessionInfo.style('visibility', 'visible');
    sessionInfo.html(sessionTemplate(session))
                .style('left', function (d) {
                    sessionInfoWidth = $(this).width();
                    xPosition = xScale(dateFormat.parse(session.display_date));
                    return xPosition - mScale(xPosition - margin.left) * sessionInfoWidth + 'px';
                })
                .style('top', margin.top  + 'px');

    var lowEnd = (sizeOf(selected) > 0) ? lowOpacity : 1;
    da.call(highlightSelected, lowEnd, 1)
        .attr('stroke', 'black')
        .attr('stroke-dasharray', 'none')
        .attr('stroke-opacity', 1)
        .attr('stroke-width', 1);
    var lowEnd = (sizeOf(selected) > 0) ? lowestOpacity : lowerOpacity;
    sessions.filter(function (d) { return session != d; })
            .call(highlightSelected, lowEnd, higherOpacity)
            .attr('stroke', function (d) { return cScale(d.location_group); })
            .attr('stroke-dasharray', '3,2')
            .attr('stroke-opacity', highOpacity)
            .attr('stroke-width', highOpacity);

}

function mouseover () {
    var lowEnd = (sizeOf(selected) > 0) ? lowestOpacity : lowerOpacity;
    sessions.call(highlightSelected, lowEnd, higherOpacity);
    sessionInfo.style('visibility', 'visible');
    plotEvents.style('opacity', lowOpacity);
    eventLines.attr('opacity', lowOpacity);
    d3.selectAll('.legend').attr('opacity', lowOpacity);
}
function mouseout () {
    if (sizeOf(selected) > 0) {
        sessions.call(highlightSelected, lowestOpacity, higherOpacity)
                .attr('stroke', 'none');
    } else {
        sessions.attr('fill-opacity', mediumOpacity)
                .attr('stroke', 'none');
    }

    sessionInfo.style('visibility', 'hidden');
    plotEvents.style('opacity', 1);
    eventLines.attr('opacity', 1);
    d3.selectAll('.legend').attr('opacity', 1);
}

function mousemove () {
    var x0 = xScale.invert(d3.mouse(this)[0]),
        i = bisectDate(satchmo_data, x0, 1),
        d0 = satchmo_data[i - 1],
        d1 = satchmo_data[i],
        da = x0 - dateFormat.parse(d0.display_date) > dateFormat.parse(d1.display_date) - x0 ? d1 : d0;

    var lowEnd = (sizeOf(selected) > 0) ? lowOpacity : 1;
    sessions.filter(function (d) { return da == d; })
            .call(highlightSelected, lowEnd, 1)
            .attr('stroke', 'black')
            .attr('stroke-dasharray', 'none')
            .attr('stroke-opacity', 1)
            .attr('stroke-width', 1);

    sessionInfo.html(sessionTemplate(da))
                .style('left', function (d) {
                    sessionInfoWidth = $(this).width();
                    xPosition = xScale(dateFormat.parse(da.display_date));
                    return xPosition - mScale(xPosition - margin.left) * sessionInfoWidth + 'px';
                })
                .style('top', 20  + 'px');

    var lowEnd = (sizeOf(selected) > 0) ? lowestOpacity : lowerOpacity;
    sessions.filter(function (d) { return da != d; })
            .call(highlightSelected, lowEnd, higherOpacity)
            .attr('stroke', function (d) { return cScale(d.location_group); })
            .attr('stroke-dasharray', '3,2')
            .attr('stroke-opacity', highOpacity)
            .attr('stroke-width', highOpacity);

}

// Add legend

var legend = svg.append('g')
    .attr('class', 'legend')
    .attr('transform', function (d) { return 'translate(60, ' + (height - 60) + ')'; })

legend.append('text')
    .attr('fill', 'black')
    .attr('text-anchor', 'middle')
    .attr('x', 0)
    .attr('y', -rScale.range()[1] - 10)
    .text('Band size');

legend.append('circle')
    .attr('r', rScale.range()[1])
    .attr('cx', 0)
    .attr('cy', 0)
    .attr('fill', 'none')
    .attr('stroke-width', 1)
    .attr('stroke-dasharray', '2,2')
    .attr('stroke', '#555');

legend.append('circle')
    .attr('r', rScale.range()[0])
    .attr('cx', 0)
    .attr('cy', rScale.range()[1] - rScale.range()[0])
    .attr('fill', 'none')
    .attr('stroke-width', 1)
    .attr('stroke-dasharray', '2,2')
    .attr('stroke', '#555');

legend.append('text')
    .text(rScale.domain()[1])
    .attr('fill', '#555')
    .attr('font-size', 12)
    .attr('text-anchor', 'left')
    .attr('dy', 4)
    .attr('x', rScale.range()[1] + 13);

legend.append('line')
    .attr('stroke-width', 1)
    .attr('stroke', '#555')
    .attr('x1', rScale.range()[1] + 2)
    .attr('x2', rScale.range()[1] + 10)
    .attr('y1', 0)
    .attr('y2', 0);

legend.append('text')
    .text('2')
    .attr('fill', '#555')
    .attr('font-size', 12)
    .attr('text-anchor', 'left')
    .attr('dy', 4)
    .attr('x', rScale.range()[1] + 13)
    .attr('y', rScale.range()[1] - rScale.range()[0]);

legend.append('line')
    .attr('stroke-width', 1)
    .attr('stroke', '#555')
    .attr('x1', rScale.range()[0] + 2)
    .attr('x2', rScale.range()[1] + 10)
    .attr('y1', rScale.range()[1] - rScale.range()[0])
    .attr('y2', rScale.range()[1] - rScale.range()[0]);

// Add axis

svg.append('g')
    .attr('class', 'x axis')
    .attr('transform', function (d) { return 'translate(0, ' + height + ')'; })
    .call(xAxis);

svg.append('g')
    .attr('transform', function (d) { return 'translate(0, 0)'; })
    .attr('class', 'y axis')
    .call(yAxis);

// now add titles to the axes
svg.append("text")
    .attr('class', 'axis-label')
    .attr("text-anchor", "middle")  // this makes it easy to centre the text as the transform is applied to the anchor
    .attr("transform", "translate(-"+ (margin.left - 7)+","+(2*height/3)+")rotate(90)")  // text is drawn off the screen top left, move down and out and rotate
    .text("Number of recordings in a year");

svg.append("text")
    .attr('class', 'axis-label')
    .attr("text-anchor", "middle")  // this makes it easy to centre the text as the transform is applied to the anchor
    .attr("transform", "translate("+ (width/2) +","+(height+margin.bottom)+")")  // centre below axis
    .text("Date");


// Initial transition

n = satchmo_data.length;
duration = 1500;

containerPosition = $('#satchmo-container').position();
containerHeight = $('#satchmo-container').height();
windowHeight = $(window).height();
notFired = true;

$(window).scroll(function () {
    if (notFired) {
        if ((windowHeight + $(this).scrollTop()) >= (containerPosition.top + containerHeight - 100)) {
            notFired = false;
            setTimeout(transitionSessions, 1);
        }
    }
});
function transitionSessions() {
    sessions.transition()
        .delay(function(d, i) { return 50 + i / n * duration; })
        // .attr('fill-opacity', 0.3)
        // .transition()
        // .delay(function(d, i) { return duration + i / n * duration / 3; })
        .attr('r', function (d) { return rScale(d.members.length); })
        .attr('fill', function (d) { return cScale(d.location_group); })
        .attr('cy', function (d) { return yScale(d.density); });
}

// Zoom functions

function zoomed() {
    if (xScale.domain()[0] < minDate) {
        var x = zoom.translate()[0] - xScale(minDate) + xScale.range()[0];
        zoom.translate([x, 0]);
    } else if (xScale.domain()[1] > maxDate) {
        var x = zoom.translate()[0] - xScale(maxDate) + xScale.range()[1];
        zoom.translate([x, 0]);
    }
    redrawChart();
}

function redrawChart() {
    svg.select('.x.axis').call(xAxis);
    sessions.attr('cx', function (d) { return xScale(dateFormat.parse(d.display_date)); });
    plotEvents.style('left', function (d) { return xScale(dateFormat.parse(d.date)) + 'px'; });
    eventLines.attr('x1', function (d) { return xScale(dateFormat.parse(d.date)); })
                .attr('x2', function (d) { return xScale(dateFormat.parse(d.date)); });

    // Prikaz eventov:
    // Preveri xScale.domain()
    // Ce je interval vecji od x, skrij vse plotEvente, ki imajo level vecji od y
}

</script>
</form></div>

<!--   <div class="invitation text-center">Did you like this post? Subscribe to my blog and be notified whenever I post something new!
    <br/>
    <br/>
    <a href="http://eepurl.com/bc2g2v" target="_blank" class="button">Subscribe >></a>
</div> -->
  </article>



        </div>
      </div>

    <footer class="row clear text-center gray">
    <a href="/" class="footer-heading inline-block gray">My Musings on Music</a> - content and design by Žan Anderle
</footer>


    </body>
</html>